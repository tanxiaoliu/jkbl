<!DOCTYPE html>
<html>
<head>
    <tc_include file="Public:head" />
    <link rel="stylesheet" href="__TMPL__Public/assets/css/shop.css">
    <link rel="stylesheet" href="__TMPL__Public/assets/css/style.css">
    <link rel="stylesheet" href="__TMPL__Public/assets/css/xcConfirm.css">
</head>
<body style="overflow: auto">

<div>
    <tc_include file="Public:nav" />
    <div class="content">
        <div class="personal">
            <div class="name">
                <ul>
                    <li><img class="img1" src="{$userInfo->headimgurl}"></li>
                    <li style="margin-top: 0.2rem;">{$userInfo->nickname|substr=0,5,'utf-8'}</li>
                </ul>
            </div>
            <div class="bi">
                <ul>
                    <li>总获取腾币：{$allscore}</li>
                    <li style="color: #81c268;">可兑换腾币：{$nowscore}</li>
                </ul>
            </div>
            <div class="btn">
                <ul>
                    <li><a style="color:white;" href="{:U('coinList')}">腾币记录</a></li>
                    <li style="background: #81c268;"><a style="color:white;" href="{:U('orderList')}">兑换记录</a></li>
                </ul>
            </div>
        </div>
        <div class="health">
            <div class="health-title">
                <ul>
                    <li class="health-title-li">
                        <span class="type"><img src="__TMPL__Public/assets/images/lp1.png" style="width: 0.9rem; height: 0.9rem; margin: 0.2rem 0.4rem 0.3rem  0.4rem;">健身福利</span>
                        <span>犒劳自己，兑换健身用品</span>
                    </li>
                </ul>
            </div>
            <div class="health-shop">
                <ul>      
                    <foreach name="selfgood" item="vo">
                        <li>
                            <img src="/data/upload/{$vo.url}">
                            <input type="hidden" value="{$vo.id}">
                            <span style="font-size: 0.6rem; color: #323232;">{$vo.name}</span>
                            <span>￥{$vo.price}腾币 <a href="#loginmodal" class="flatbtn modaltrigger" style="color: #81c268;"> 兑换</a></span>
                        </li>
                    </foreach> 
                </ul>
            </div>
        </div>
        <div class="commonweal">
            <div class="commonweal-title">
                <ul>
                    <li class="health-title-li">
                        <span class="type"><img src="__TMPL__Public/assets/images/lp2.png" style="width: 0.9rem; height: 0.9rem; margin: 0.2rem 0.4rem 0.3rem  0.4rem;">公益福利</span>
                        <span>帮助他人</span>
                    </li>
                </ul>
            </div>
            <div class="commonweal-shop">
                <ul>
                   <foreach name="othergood" item="vo">
                        <li>
                            <span>{$vo.name}</span>
                            <img src="/data/upload/{$vo.url}">
                            <input type="hidden" value="{$vo.id}">
                            <span>￥{$vo.price}腾币 <a href="javascript:void(0)" class="gongyi"> 兑换</a></span>
                        </li>
                    </foreach> 
                </ul>
            </div>
        </div>
    </div>
    <tc_include file="Public:footer" />

      <div id="loginmodal" style="display:none;">

        <form id="loginform" name="loginform" method="post" action="{:U('buy')}" onsubmit="return check(this)">
          <input type="hidden" name="url" id="url" value="{:U('buy')}">
          <input type="hidden" name="goodid" id="goodid" value="">
          <label for="username">收件人:</label>

          <input type="text" name="username" id="username" class="txtfield" tabindex="1">
          

          <label for="username">联系电话:</label>

          <input type="text" name="phone" id="phone" class="txtfield" tabindex="2">

          <label for="username">地址:</label>

          <input type="text" name="address" id="address" class="txtfield" tabindex="2">

          
          <div class="center"><input type="submit" name="loginbtn" id="loginbtn" class="flatbtn-blu" value="提交" tabindex="3">
          <input type="reset" name="loginbtn" id="loginbtn" class="flatbtn-blu hidemodal" value="取消" tabindex="3"></div>

        </form>

      </div>
</div>
<script>
    $(function(){
        $('.modaltrigger').leanModal({ top: 110, overlay: 0.45, closeButton: ".hidemodal" });
        // $('.modaltrigger').leanModal({ top: 110, overlay: 0.45});
        $(".flatbtn").each(function(i){
             $(this).click(function(){
                $("#goodid").val($(this).parent().prev().prev().val())
              })
          });
        $(".gongyi").each(function(i){
             $(this).click(function(){
                  if (confirm("确认要捐赠公益吗")) {
                       $("#goodid").val($(this).parent().prev().val())
                       var url = $("#url").val();
                       $.post(url,$("#loginform").serialize(),function(data){
      /*                    console.log($("#loginform").serialize())
                          console.log(data)*/
                          if (data.status==1&&data.state=='success') {
                              alert(data.info)
                              window.location.href=data.url; 
                          }else{
                              alert(data.info)
                          }
                        },
                        "json");//这里返回的类型有：json,html,xml,text
                 }else{
                      return;
                 }
              })
          });

         $(".top ul li").click(function(){
            $(this).addClass("white").siblings().removeClass("white");
        });


    });
     function check(form) {
          if(form.username.value=='') {
                var txt=  "请输入收件人";
                window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.info);
                form.username.focus();
                return false;
           }
           if(form.phone.value=='') {
                var txt=  "请输入联系电话";
                window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.info);
                form.phone.focus();
                return false;
           }else{
            var reg = /^1[3|4|5|7|8][0-9]{9}$/; //验证规则
            var phoneNum = form.phone.value;//手机号码
            if (!reg.test(phoneNum)){
                var txt=  "手机格式不对";
                window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.info);
                form.phone.focus();
                return false;
            }
           }
           if(form.address.value=='') {
                var txt=  "请输入地址";
                window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.info);
                form.address.focus();
                return false;
           }
           if (confirm("请确认信息后下单")) {
                 var url = $("#url").val();;
                 $.post(url,$("#loginform").serialize(),function(data){
/*                    console.log($("#loginform").serialize())
                    console.log(data)*/
                    if (data.status==1&&data.state=='success') {
                        window.wxc.xcConfirm(data.info, window.wxc.xcConfirm.typeEnum.info);
                        alert(data.info);
                        window.location.href=data.url; 
                    }else{
                        window.wxc.xcConfirm(data.info, window.wxc.xcConfirm.typeEnum.info);
                    }
                  },
                  "json");//这里返回的类型有：json,html,xml,text
                return false;
           }else{
                return false;
           }
         }
</script>
<script src="__TMPL__Public/assets/js/jquery-1.9.1.min.js"></script>
<script src="__TMPL__Public/assets/js/jquery.leanModal.min.js"></script>
<script src="__TMPL__Public/assets/js/xcConfirm.js"></script>

</body>
</html>